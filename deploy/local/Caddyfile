{
    email evin@evindrake.net
}

# Default health endpoint for Docker healthchecks
:80 {
    respond /health 200
    respond 404
}

plex.evindrake.net {
    reverse_proxy 172.17.0.1:32400 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Plex-Client-Identifier {http.request.header.X-Plex-Client-Identifier}
        header_up X-Plex-Token {http.request.header.X-Plex-Token}
        header_up Upgrade {http.request.header.Upgrade}
        header_up Connection {http.request.header.Connection}
        transport http {
            read_timeout 120s
            write_timeout 120s
        }
    }
}

vnc.evindrake.net {
    reverse_proxy 172.17.0.1:6080 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up Upgrade {http.request.header.Upgrade}
        header_up Connection {http.request.header.Connection}
    }
    
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "no-referrer"
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    }
}

home.evindrake.net {
    reverse_proxy host.docker.internal:8123 {
        header_up Upgrade {>Upgrade}
        header_up Connection {>Connection}
        header_up X-Forwarded-Host {host}
        
        transport http {
            read_timeout 90s
            write_timeout 90s
        }
    }
}

game.evindrake.net {
    reverse_proxy 172.17.0.1:47990 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-Proto {scheme}
        header_up Upgrade {http.request.header.Upgrade}
        header_up Connection {http.request.header.Connection}
        transport http {
            read_timeout 120s
            write_timeout 120s
        }
    }
    
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        Referrer-Policy "strict-origin-when-cross-origin"
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }
}

dashboard.evindrake.net {
    reverse_proxy homelab-dashboard:5000 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-Proto {scheme}
        header_up Upgrade {http.request.header.Upgrade}
        header_up Connection {http.request.header.Connection}
    }
    
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        Referrer-Policy "strict-origin-when-cross-origin"
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }
}

minio.evindrake.net {
    reverse_proxy homelab-minio:9001 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }
}

storage.evindrake.net {
    reverse_proxy homelab-minio:9000 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }
}

torrent.evindrake.net {
    reverse_proxy host.docker.internal:8080 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }
}

local.evindrake.net {
    respond "Homelab Local Server - Online" 200
}
