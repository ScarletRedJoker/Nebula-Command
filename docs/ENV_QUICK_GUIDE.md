# üîë Environment Variables - Quick Guide

Simple guide to check and update all your environment variables.

## üóÑÔ∏è Database Auto-Configuration

The unified deployment system automatically creates and manages PostgreSQL databases:

- **Discord Bot**: Database `ticketbot`, User `ticketbot`, Password from `DISCORD_DB_PASSWORD`
- **Stream Bot**: Database `streambot`, User `streambot`, Password from `STREAMBOT_DB_PASSWORD`

Both databases are created automatically on first deployment using `config/postgres-init/01-init-databases.sh`.

**Important**: Re-running `generate-unified-env.sh` will **preserve** existing database passwords, ensuring your data remains accessible.

### Database Management Tool

Use the migration helper for database operations:

```bash
./migrate-database.sh
```

Options:
1. Check database status
2. Reset all databases (fresh start)
3. Reset Discord Bot DB only
4. Reset Stream Bot DB only

---

## üöÄ Quick Check

Run this anytime to see what's missing:

```bash
cd ~/contain/HomeLabHub
./check-all-env.sh
```

This will show you:
- ‚úì **Green checkmarks** - Variable is set correctly
- ‚ö† **Yellow warnings** - Using placeholder value (needs real value)
- ‚úó **Red X's** - Variable is missing

---

## üìù How to Fix Missing Variables

### 1. Edit Your .env File

```bash
nano ~/contain/HomeLabHub/.env
```

### 2. Fill In The Values

The check script tells you exactly where to get each value. Here are the most important ones:

#### **Discord Bot (REQUIRED for OAuth)**

```bash
# Go to: https://discord.com/developers/applications
DISCORD_BOT_TOKEN="your_bot_token_here"
DISCORD_CLIENT_ID="your_client_id_here"
DISCORD_CLIENT_SECRET="your_client_secret_here"
DISCORD_APP_ID="your_app_id_here"
VITE_DISCORD_CLIENT_ID="same_as_client_id"

# IMPORTANT: Also add this redirect URI in Discord Developer Portal:
# https://bot.rig-city.com/callback
```

#### **Stream Bot (For Twitch)**

```bash
# Go to: https://dev.twitch.tv/console/apps
TWITCH_CLIENT_ID="your_twitch_client_id"
TWITCH_CLIENT_SECRET="your_twitch_client_secret"
TWITCH_CHANNEL="your_twitch_username"

# Database password (auto-generated, do not edit manually)
STREAMBOT_DB_PASSWORD="auto-generated-by-script"
```

#### **OpenAI (For AI Features)**

```bash
# Go to: https://platform.openai.com/api-keys
OPENAI_API_KEY="sk-proj-xxxxxxxxxxxxxxxxxx"
AI_INTEGRATIONS_OPENAI_API_KEY="sk-proj-xxxxxxxxxxxxxxxxxx"
```

#### **Security (Change Defaults!)**

```bash
# Dashboard login (CHANGE THESE!)
WEB_USERNAME="evin"
WEB_PASSWORD="your_secure_password_here"  # NOT "homelab"!

# VNC password
VNC_PASSWORD="your_vnc_password_here"
```

### 3. Save and Check Again

```bash
# Save the file (Ctrl+X, Y, Enter)

# Run check again
./check-all-env.sh
```

---

## üéØ Critical Setup Steps

### Discord OAuth Setup

After adding Discord env vars, you **MUST** also:

1. Go to https://discord.com/developers/applications
2. Select your application
3. Go to **OAuth2** ‚Üí **Redirects**
4. Add: `https://bot.rig-city.com/callback`
5. Click **Save Changes**

Without this, Discord login won't work!

### Twitch Setup

1. Go to https://dev.twitch.tv/console/apps
2. Create a new application or select existing
3. Get Client ID and generate a new secret
4. Add redirect URI: `https://stream.rig-city.com/callback`

---

## üîê Auto-Generated Secrets

These are fine to leave as-is (they're generated automatically):

- `DASHBOARD_API_KEY` - Generated by setup script
- `SESSION_SECRET` - Generated by setup script
- `DISCORD_SESSION_SECRET` - Generated by setup script
- `STREAMBOT_SESSION_SECRET` - Generated by setup script
- `DISCORD_DB_PASSWORD` - Generated by setup script

---

## ‚ö° After Updating

Once all variables are set:

```bash
# Check everything is good
./check-all-env.sh

# If all green checkmarks, redeploy
./deploy-unified.sh
```

---

## üÜò Common Issues

### "Discord OAuth not working"
- ‚úì Check redirect URI is added in Discord Developer Portal
- ‚úì Verify DISCORD_CLIENT_ID and VITE_DISCORD_CLIENT_ID match
- ‚úì Make sure DISCORD_CLIENT_SECRET is correct

### "Stream Bot not starting"
- ‚úì Check STREAMBOT_DATABASE_URL format
- ‚úì Verify Twitch credentials are correct
- ‚úì Make sure TWITCH_CHANNEL is your exact username

### "AI features not working"
- ‚úì Verify OpenAI API key is valid
- ‚úì Check you have credits in your OpenAI account
- ‚úì Both OPENAI_API_KEY and AI_INTEGRATIONS_OPENAI_API_KEY should be set

---

## üìã Complete Variable List

Run `./check-all-env.sh` to see the complete list with status indicators!

---

**Made a mistake?** Just edit `.env` again and redeploy. The script will tell you exactly what's wrong! üöÄ
