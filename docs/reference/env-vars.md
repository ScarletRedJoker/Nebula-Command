# Environment Variables Reference

Complete documentation for all environment variables used in HomeLabHub.

> **Security Note**: Never commit your `.env` file to version control. Always use `.env.example` as a template.

---

## Quick Setup

```bash
# 1. Copy the template
cp .env.example .env

# 2. Generate secure passwords
openssl rand -hex 32  # For secrets

# 3. Secure the file
chmod 600 .env

# 4. Run bootstrap
./bootstrap-homelab.sh
```

---

## Variable Categories

| Category | Variables | Required |
|----------|-----------|----------|
| [Core Configuration](#1-core-configuration) | 10 | ✓ |
| [Database Passwords](#2-database-passwords) | 3 | ✓ |
| [AI Configuration](#3-ai-configuration) | 4 | ✓ |
| [Discord Bot](#4-discord-bot) | 8 | ✓ |
| [Stream Bot](#5-stream-bot) | 18 | ○ |
| [n8n Automation](#6-n8n-automation) | 5 | ○ |
| [Code Server](#7-code-server) | 1 | ○ |
| [Path Configuration](#8-path-configuration) | 4 | ○ |
| [Local Services](#9-local-services) | 14 | ○ |
| [NAS Storage](#10-nas-storage) | 5 | ○ |
| [Fleet Management](#11-fleet-management) | 7 | ○ |
| [DNS Management](#12-dns-management) | 6 | ○ |
| [Google Services](#13-google-services) | 9 | ○ |
| [Service URLs](#14-service-urls) | 4 | ○ |
| [Runtime Environment](#15-runtime-environment) | 3 | Auto |

**Legend**: ✓ = Required, ○ = Optional, Auto = Auto-configured

---

## 1. Core Configuration

These variables are **required** for the homelab to function.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `SERVICE_USER` | ✓ | All | `evin` | Linux username for file permissions |
| `TZ` | ✓ | All | `America/New_York` | Timezone for all containers |
| `PUID` | ✓ | All | `1000` | User ID for container file ownership |
| `PGID` | ✓ | All | `1000` | Group ID for container file ownership |
| `POSTGRES_PASSWORD` | ✓ | PostgreSQL | `********` | PostgreSQL superuser password |
| `WEB_USERNAME` | ✓ | Dashboard | `admin` | Dashboard login username |
| `WEB_PASSWORD` | ✓ | Dashboard | `********` | Dashboard login password |
| `SESSION_SECRET` | ✓ | Dashboard | `<64-char-hex>` | Flask session encryption key |
| `SECRET_KEY` | ✓ | Dashboard | `<64-char-hex>` | Flask secret key |
| `DASHBOARD_API_KEY` | ✓ | Dashboard | `<64-char-hex>` | API key for external dashboard access |

### Details

#### `SERVICE_USER`
- **Required**: Yes
- **Used by**: All containers (file permissions)
- **Default**: `evin`
- **Description**: The Linux username that owns the homelab files. Used for volume mounts and file permissions.
- **How to obtain**: Run `whoami` on your host system

#### `TZ`
- **Required**: Yes
- **Used by**: All containers
- **Default**: `America/New_York`
- **Description**: Timezone for log timestamps and scheduled tasks
- **How to obtain**: [List of TZ database names](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)

#### `PUID` / `PGID`
- **Required**: Yes
- **Used by**: All containers
- **Default**: `1000`
- **Description**: User/Group ID for file ownership inside containers
- **How to obtain**: Run `id -u` and `id -g` on your host system

#### `POSTGRES_PASSWORD`
- **Required**: Yes
- **Used by**: PostgreSQL, Dashboard, Discord Bot, Stream Bot
- **Example**: `your-secure-postgres-password`
- **Description**: Master password for PostgreSQL superuser
- **How to generate**: `openssl rand -hex 32`

#### `WEB_USERNAME` / `WEB_PASSWORD`
- **Required**: Yes
- **Used by**: Dashboard
- **Example**: `admin` / `your-secure-password`
- **Description**: Login credentials for the web dashboard
- **How to generate**: Choose a username, generate password with `openssl rand -hex 16`

#### `SESSION_SECRET` / `SECRET_KEY`
- **Required**: Yes
- **Used by**: Dashboard (Flask)
- **Example**: `<64-character-hex-string>`
- **Description**: Encryption keys for Flask sessions and CSRF protection
- **How to generate**: `openssl rand -hex 32`

#### `SERVICE_AUTH_TOKEN`
- **Required**: Auto-generated
- **Used by**: Inter-service communication
- **Description**: Token for service-to-service authentication
- **How to generate**: Auto-generated by `bootstrap-homelab.sh` if missing

#### `DASHBOARD_API_KEY`
- **Required**: Yes
- **Used by**: External API access
- **Description**: API key for programmatic dashboard access
- **How to generate**: `openssl rand -hex 32`

---

## 2. Database Passwords

Separate database credentials for each service (security isolation).

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `DISCORD_DB_PASSWORD` | ✓ | Discord Bot | `********` | Password for `ticketbot` database user |
| `STREAMBOT_DB_PASSWORD` | ✓ | Stream Bot | `********` | Password for `streambot` database user |
| `JARVIS_DB_PASSWORD` | ✓ | Dashboard | `********` | Password for `jarvis` database user |

### Database Architecture

```
PostgreSQL (homelab-postgres)
├── Database: ticketbot     → User: ticketbot   → Discord Bot
├── Database: streambot     → User: streambot   → Stream Bot
└── Database: homelab_jarvis → User: jarvis     → Dashboard/JARVIS
```

### How to Generate

```bash
# Generate all three passwords at once
echo "DISCORD_DB_PASSWORD=$(openssl rand -hex 24)"
echo "STREAMBOT_DB_PASSWORD=$(openssl rand -hex 24)"
echo "JARVIS_DB_PASSWORD=$(openssl rand -hex 24)"
```

> **Important**: These passwords are used to construct internal `DATABASE_URL` variables automatically. Do not set `DATABASE_URL` directly.

---

## 3. AI Configuration

OpenAI integration for JARVIS AI assistant and fact generation.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `OPENAI_API_KEY` | ✓ | Dashboard, Stream Bot | `sk-proj-abc...xyz` | OpenAI API key |
| `OPENAI_BASE_URL` | ○ | Dashboard, Stream Bot | `https://api.openai.com/v1` | OpenAI API endpoint |
| `AI_PROVIDER` | ○ | Dashboard | `openai` | AI provider (currently only OpenAI) |
| `AI_MODEL` | ○ | Dashboard | `gpt-4o` | Default AI model |

### Details

#### `OPENAI_API_KEY`
- **Required**: Yes (for AI features)
- **Used by**: Dashboard (JARVIS), Stream Bot (facts generation)
- **Example**: `sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxxxx`
- **Description**: API key for OpenAI services
- **How to obtain**: 
  1. Go to [OpenAI API Keys](https://platform.openai.com/api-keys)
  2. Click "Create new secret key"
  3. Copy the key (shown only once!)

#### `OPENAI_BASE_URL`
- **Required**: No
- **Default**: `https://api.openai.com/v1`
- **Description**: Base URL for OpenAI API (useful for proxies or alternative endpoints)

#### `AI_PROVIDER`
- **Required**: No
- **Default**: `openai`
- **Description**: AI provider selection (future expansion)

#### `AI_MODEL`
- **Required**: No
- **Default**: `gpt-4o`
- **Options**: `gpt-4o`, `gpt-4o-mini`, `gpt-4-turbo`, `gpt-3.5-turbo`
- **Description**: Default model for AI operations

---

## 4. Discord Bot

Configuration for the Discord ticketing and notification bot.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `DISCORD_BOT_TOKEN` | ✓ | Discord Bot | `MTIz...` | Bot authentication token |
| `DISCORD_CLIENT_ID` | ✓ | Discord Bot | `123456789012345678` | OAuth2 Client ID |
| `DISCORD_CLIENT_SECRET` | ✓ | Discord Bot | `********` | OAuth2 Client Secret |
| `DISCORD_APP_ID` | ○ | Discord Bot | `123456789012345678` | Application ID (defaults to CLIENT_ID) |
| `VITE_DISCORD_CLIENT_ID` | ○ | Discord Bot Web | `123456789012345678` | Client ID for web frontend |
| `DISCORD_SESSION_SECRET` | ✓ | Discord Bot | `<64-char-hex>` | Session encryption key |
| `VITE_CUSTOM_WS_URL` | ○ | Discord Bot | *(empty)* | Custom WebSocket URL |
| `RESET_DB` | ○ | Discord Bot | `false` | Reset database on startup |

### How to Obtain Discord Credentials

1. Go to [Discord Developer Portal](https://discord.com/developers/applications)
2. Click "New Application" and name it
3. Navigate to **Bot** section:
   - Click "Reset Token" to get `DISCORD_BOT_TOKEN`
   - Enable "Message Content Intent" under Privileged Gateway Intents
4. Navigate to **OAuth2** section:
   - Copy "Client ID" → `DISCORD_CLIENT_ID`
   - Click "Reset Secret" → `DISCORD_CLIENT_SECRET`

### Bot Invite URL

```
https://discord.com/api/oauth2/authorize?client_id=YOUR_CLIENT_ID&permissions=8&scope=bot%20applications.commands
```

---

## 5. Stream Bot

Multi-platform streaming integration (Twitch, YouTube, Spotify, Kick).

### Core Settings

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `STREAMBOT_SESSION_SECRET` | ○ | Stream Bot | `<64-char-hex>` | Session encryption key |
| `STREAMBOT_PORT` | ○ | Stream Bot | `5000` | Internal port |
| `STREAMBOT_NODE_ENV` | ○ | Stream Bot | `production` | Node environment |
| `STREAMBOT_OPENAI_API_KEY` | ○ | Stream Bot | `sk-proj-...` | Dedicated OpenAI key (falls back to main) |
| `STREAMBOT_OPENAI_BASE_URL` | ○ | Stream Bot | `https://api.openai.com/v1` | OpenAI endpoint |
| `STREAMBOT_FACT_MODEL` | ○ | Stream Bot | `gpt-4o` | Model for fact generation |

### Twitch Integration

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `TWITCH_CLIENT_ID` | ○ | Stream Bot | `abc123...` | Twitch application Client ID |
| `TWITCH_CLIENT_SECRET` | ○ | Stream Bot | `********` | Twitch application Client Secret |
| `TWITCH_CHANNEL` | ○ | Stream Bot | `your_channel` | Default Twitch channel |
| `TWITCH_REDIRECT_URI` | ○ | Stream Bot | `https://stream.rig-city.com/api/auth/twitch/callback` | OAuth callback URL |

**How to Obtain**:
1. Go to [Twitch Developer Console](https://dev.twitch.tv/console/apps)
2. Click "Register Your Application"
3. Set OAuth Redirect URL to your callback URL
4. Copy Client ID and generate Client Secret

### YouTube Integration

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `YOUTUBE_CLIENT_ID` | ○ | Stream Bot | `123...apps.googleusercontent.com` | Google OAuth Client ID |
| `YOUTUBE_CLIENT_SECRET` | ○ | Stream Bot | `GOCSPX-...` | Google OAuth Client Secret |
| `YOUTUBE_REFRESH_TOKEN` | ○ | Stream Bot | `1//0g...` | OAuth refresh token |
| `YOUTUBE_REDIRECT_URI` | ○ | Stream Bot | `https://stream.rig-city.com/api/auth/youtube/callback` | OAuth callback URL |

**How to Obtain**:
1. Go to [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
2. Create a project if needed
3. Enable YouTube Data API v3
4. Create OAuth 2.0 Client ID (Web application type)
5. Add redirect URI and copy credentials

### Spotify Integration

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `SPOTIFY_CLIENT_ID` | ○ | Stream Bot | `abc123...` | Spotify application Client ID |
| `SPOTIFY_CLIENT_SECRET` | ○ | Stream Bot | `********` | Spotify application Client Secret |
| `SPOTIFY_REFRESH_TOKEN` | ○ | Stream Bot | `AQB...` | OAuth refresh token |
| `SPOTIFY_REDIRECT_URI` | ○ | Stream Bot | `https://stream.rig-city.com/api/auth/spotify/callback` | OAuth callback URL |

**How to Obtain**:
1. Go to [Spotify Developer Dashboard](https://developer.spotify.com/dashboard)
2. Create an app
3. Add redirect URI in app settings
4. Copy Client ID and Client Secret

### Kick Integration

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `KICK_CLIENT_ID` | ○ | Stream Bot | `abc123...` | Kick application Client ID |
| `KICK_CLIENT_SECRET` | ○ | Stream Bot | `********` | Kick application Client Secret |
| `KICK_REDIRECT_URI` | ○ | Stream Bot | `https://stream.rig-city.com/api/auth/kick/callback` | OAuth callback URL |

**How to Obtain**:
1. Go to [Kick Developer Portal](https://kick.com/developers)
2. Register as a developer
3. Create an application

---

## 6. n8n Automation

n8n workflow automation platform configuration.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `N8N_HOST` | ○ | n8n | `n8n.evindrake.net` | n8n hostname |
| `N8N_WEBHOOK_URL` | ○ | n8n | `https://n8n.evindrake.net/` | Webhook base URL |
| `N8N_BASIC_AUTH_ACTIVE` | ○ | n8n | `true` | Enable basic auth |
| `N8N_BASIC_AUTH_USER` | ○ | n8n | `admin` | Basic auth username |
| `N8N_BASIC_AUTH_PASSWORD` | ○ | n8n | `********` | Basic auth password |

### Details

n8n is a self-hosted workflow automation platform similar to Zapier. These variables configure its external access and authentication.

**How to Generate Password**:
```bash
openssl rand -hex 16
```

---

## 7. Code Server

VS Code in the browser configuration.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `CODE_SERVER_PASSWORD` | ○ | Code Server | `********` | Login password for code-server |

### Details

Code Server provides a full VS Code experience in your browser. The password protects access to your development environment.

**How to Generate**:
```bash
openssl rand -base64 24
```

---

## 8. Path Configuration

Container and host path mappings.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `HOST_STATIC_SITE_PATH` | ○ | Dashboard | `./static-sites` | Host directory for static sites |
| `HOMELAB_PROJECT_ROOT` | Auto | Dashboard | `/project` | Container path to repo (auto-set) |
| `MARKETPLACE_DIR` | Auto | Dashboard | `/marketplace` | Marketplace deployments (auto-set) |
| `STATIC_SITE_PATH` | Auto | Dashboard | `/var/www` | Static site content (auto-set) |

> **Note**: The `HOMELAB_PROJECT_ROOT`, `MARKETPLACE_DIR`, and `STATIC_SITE_PATH` are automatically set by `docker-compose.yml`. Only modify if you understand the container architecture.

---

## 9. Local Services

Services that run on your local Ubuntu host (not Linode cloud).

### Tailscale Configuration

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `LOCAL_TAILSCALE_IP` | ○ | All local | `100.64.0.1` | Tailscale IP of Ubuntu host |

### Plex Media Server

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `PLEX_TOKEN` | ○ | Dashboard, Plex | `xxxxxxxxxxxxxxxxxxxx` | Plex authentication token |
| `PLEX_CLAIM` | ○ | Plex | `claim-xxxxxx` | Plex claim token (first-time setup) |
| `PLEX_URL` | ○ | Dashboard | `http://100.64.0.1:32400` | Plex server URL |
| `PLEX_MEDIA_PATH` | ○ | Plex | `/data/plex/media` | Host path to media files |

**How to Obtain PLEX_TOKEN**:
1. Open Plex Web App
2. Navigate to any media item
3. Click "Get Info" → "View XML"
4. Look for `X-Plex-Token=xxxxx` in the URL

**How to Obtain PLEX_CLAIM** (first-time setup):
1. Go to [plex.tv/claim](https://www.plex.tv/claim/)
2. Copy the claim token (valid for 4 minutes)

### Home Assistant

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `HOME_ASSISTANT_URL` | ○ | Dashboard | `http://100.64.0.1:8123` | Home Assistant URL |
| `HOME_ASSISTANT_TOKEN` | ○ | Dashboard | `eyJ0eXAi...` | Long-lived access token |
| `HOME_ASSISTANT_VERIFY_SSL` | ○ | Dashboard | `False` | Verify SSL certificates |

**How to Obtain Token**:
1. Open Home Assistant
2. Click your profile (bottom left)
3. Scroll to "Long-Lived Access Tokens"
4. Click "Create Token"

### MinIO Object Storage

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `MINIO_ROOT_USER` | ○ | MinIO | `admin` | MinIO admin username |
| `MINIO_ROOT_PASSWORD` | ○ | MinIO | `********` | MinIO admin password |
| `MINIO_ENDPOINT` | ○ | Dashboard | `minio:9000` | MinIO endpoint |
| `MINIO_USE_SSL` | ○ | Dashboard | `false` | Use SSL for MinIO |
| `MINIO_BUCKET_NAME` | ○ | Dashboard | `homelab-uploads` | Default bucket name |

### VNC Remote Desktop

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `VNC_PASSWORD` | ○ | VNC | `********` | VNC connection password |
| `VNC_USER` | ○ | VNC | `evin` | VNC username |
| `VNC_USER_PASSWORD` | ○ | VNC | `********` | VNC user password |

---

## 10. NAS Storage

Network Attached Storage configuration.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `NAS_IP` | ○ | Dashboard | `192.168.1.100` | NAS IP address |
| `NAS_HOSTNAME` | ○ | Dashboard | `zyxel-nas326` | NAS hostname |
| `NAS_USER` | ○ | Dashboard | `admin` | NAS login username |
| `NAS_PASSWORD` | ○ | Dashboard | `********` | NAS login password |
| `NAS_MOUNT_BASE` | ○ | Dashboard | `/mnt/nas` | Local mount point |

---

## 11. Fleet Management

Remote server management via Tailscale VPN mesh and SSH.

### Tailscale Host Configuration

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `TAILSCALE_LINODE_HOST` | ○ | Fleet Manager | `100.64.0.2` | Tailscale IP of Linode cloud server |
| `TAILSCALE_LOCAL_HOST` | ○ | Fleet Manager | `100.64.0.1` | Tailscale IP of local Ubuntu host |
| `LOCAL_TAILSCALE_IP` | ○ | Dashboard | `100.64.0.1` | Alias for local host IP |

### SSH Configuration

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `FLEET_SSH_KEY_PATH` | ○ | Fleet Manager | `~/.ssh/id_rsa` | Path to SSH private key |
| `FLEET_LINODE_SSH_USER` | ○ | Fleet Manager | `root` | SSH user for Linode |
| `FLEET_LOCAL_SSH_USER` | ○ | Fleet Manager | `evin` | SSH user for local host |
| `FLEET_LINODE_SSH_PASSWORD` | ○ | Fleet Manager | `********` | SSH password (fallback if no key) |
| `FLEET_LOCAL_SSH_PASSWORD` | ○ | Fleet Manager | `********` | SSH password (fallback if no key) |

### Details

#### Tailscale Setup

Fleet management uses Tailscale for secure VPN connectivity between servers. Each host needs:

1. Tailscale installed: `curl -fsSL https://tailscale.com/install.sh | sh`
2. Authenticated: `sudo tailscale up`
3. Get IP: `tailscale ip -4`

**How to Obtain Tailscale IPs**:
```bash
# On each host, run:
tailscale ip -4
```

#### SSH Key Authentication (Recommended)

For secure, password-less SSH:

```bash
# Generate SSH key pair (if you don't have one)
ssh-keygen -t ed25519 -C "homelab@fleet"

# Copy public key to remote hosts
ssh-copy-id -i ~/.ssh/id_ed25519.pub user@tailscale-ip
```

Set `FLEET_SSH_KEY_PATH` to your private key path.

---

## 12. DNS Management

Cloudflare DNS management for domain configuration.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `CLOUDFLARE_API_TOKEN` | ○ | DNS Manager | `xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx` | Cloudflare API token |
| `DNS_TARGET_IP` | ○ | DNS Manager | `192.0.2.1` | Public IP for DNS records |
| `SERVICE_CATALOG_PATH` | ○ | DNS Manager | `/config/services.yaml` | Service catalog location |
| `CONSUL_HOST` | ○ | DNS Manager | `consul-server` | Consul service discovery host |
| `SYNC_INTERVAL` | ○ | DNS Manager | `300` | DNS sync interval (seconds) |
| `LOG_LEVEL` | ○ | DNS Manager | `INFO` | DNS manager log level |

### How to Obtain Cloudflare API Token

1. Go to [Cloudflare Dashboard](https://dash.cloudflare.com/profile/api-tokens)
2. Click "Create Token"
3. Use template "Edit zone DNS" or create custom:
   - **Permissions**: Zone > DNS > Edit
   - **Zone Resources**: Include > Specific zone > Your domains
4. Copy the token (shown only once!)

### Managed Domains

The DNS service manages these domains by default:
- `evindrake.net`
- `rig-city.com`
- `scarletredjoker.com`

### DNS Record Types Supported

| Type | Description |
|------|-------------|
| `A` | IPv4 address |
| `AAAA` | IPv6 address |
| `CNAME` | Canonical name alias |
| `TXT` | Text record |
| `MX` | Mail exchange |
| `NS` | Name server |
| `SRV` | Service record |
| `CAA` | Certificate Authority Authorization |

---

## 13. Google Services

Google API integrations for Calendar, Gmail, and Drive.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `GOOGLE_TOKEN_CACHE_TTL` | ○ | Dashboard | `300` | Token cache duration (seconds) |
| `CALENDAR_POLL_INTERVAL_MINUTES` | ○ | Dashboard | `5` | Calendar sync interval |
| `CALENDAR_LEAD_TIME_MINUTES` | ○ | Dashboard | `10` | Event reminder lead time |
| `GMAIL_FROM_NAME` | ○ | Dashboard | `Homelab Dashboard` | Email sender name |
| `GMAIL_DEFAULT_RECIPIENT` | ○ | Dashboard | `you@example.com` | Default email recipient |
| `DRIVE_BACKUP_FOLDER_NAME` | ○ | Dashboard | `Homelab Backups` | Drive backup folder |
| `DRIVE_BACKUP_RETENTION_DAYS` | ○ | Dashboard | `30` | Backup retention period |
| `DRIVE_AUTO_BACKUP_ENABLED` | ○ | Dashboard | `false` | Enable automatic backups |
| `DRIVE_AUTO_BACKUP_SCHEDULE` | ○ | Dashboard | `0 2 * * *` | Cron schedule for backups |

> **Note**: Google OAuth tokens are managed through the Replit integration system or manual OAuth flow, not through environment variables.

---

## 14. Service URLs

Public URLs for your services (update with your domains).

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `DISCORD_BOT_URL` | ○ | Discord Bot | `https://bot.rig-city.com` | Public Discord bot URL |
| `N8N_URL` | ○ | n8n | `https://n8n.evindrake.net` | Public n8n URL |
| `STATIC_SITE_URL` | ○ | Static Site | `https://scarletredjoker.com` | Static website URL |
| `LETSENCRYPT_EMAIL` | ○ | Caddy | `you@example.com` | Email for SSL certificates |

---

## 15. Runtime Environment

Auto-configured runtime settings.

| Variable | Required | Service | Example | Description |
|----------|----------|---------|---------|-------------|
| `FLASK_ENV` | Auto | Dashboard | `production` | Flask environment mode |
| `FLASK_DEBUG` | Auto | Dashboard | `false` | Debug mode |
| `NODE_ENV` | Auto | Bots | `production` | Node.js environment |

> **Warning**: Never set `FLASK_DEBUG=true` or `NODE_ENV=development` in production.

---

## Variable Generation Summary

### Auto-Generated by Bootstrap

These variables are automatically generated by `bootstrap-homelab.sh` if missing:

| Variable | Generator |
|----------|-----------|
| `SERVICE_AUTH_TOKEN` | `openssl rand -hex 32` |

### Require Manual Input

Variables that must be set manually:

| Variable | Source |
|----------|--------|
| `POSTGRES_PASSWORD` | Generate with `openssl rand -hex 32` |
| `WEB_PASSWORD` | Choose a secure password |
| `SESSION_SECRET` | Generate with `openssl rand -hex 32` |
| `SECRET_KEY` | Generate with `openssl rand -hex 32` |
| `DISCORD_DB_PASSWORD` | Generate with `openssl rand -hex 24` |
| `STREAMBOT_DB_PASSWORD` | Generate with `openssl rand -hex 24` |
| `JARVIS_DB_PASSWORD` | Generate with `openssl rand -hex 24` |
| `DISCORD_BOT_TOKEN` | Discord Developer Portal |
| `DISCORD_CLIENT_ID` | Discord Developer Portal |
| `DISCORD_CLIENT_SECRET` | Discord Developer Portal |

### External API Keys Required

Variables that require API keys from external services:

| Variable | Provider | Dashboard Link |
|----------|----------|----------------|
| `OPENAI_API_KEY` | OpenAI | [platform.openai.com/api-keys](https://platform.openai.com/api-keys) |
| `DISCORD_BOT_TOKEN` | Discord | [discord.com/developers](https://discord.com/developers/applications) |
| `TWITCH_CLIENT_ID` | Twitch | [dev.twitch.tv/console](https://dev.twitch.tv/console/apps) |
| `YOUTUBE_CLIENT_ID` | Google | [console.cloud.google.com](https://console.cloud.google.com/apis/credentials) |
| `SPOTIFY_CLIENT_ID` | Spotify | [developer.spotify.com](https://developer.spotify.com/dashboard) |
| `KICK_CLIENT_ID` | Kick | [kick.com/developers](https://kick.com/developers) |
| `CLOUDFLARE_API_TOKEN` | Cloudflare | [dash.cloudflare.com/profile/api-tokens](https://dash.cloudflare.com/profile/api-tokens) |
| `PLEX_TOKEN` | Plex | Via Plex Web App (see instructions) |
| `HOME_ASSISTANT_TOKEN` | Home Assistant | Via HA profile settings |

---

## Troubleshooting

### Common Issues

#### "Missing required variables" error
```bash
# Check which variables are missing
./homelab validate-env
```

#### Database connection failed
Ensure database passwords match between `.env` and what's in PostgreSQL:
```bash
# Check current database users
docker exec homelab-postgres psql -U postgres -c "\du"
```

#### Service not starting
Check if all required variables are set:
```bash
# For Discord Bot
grep -E "^DISCORD_" .env

# For Stream Bot
grep -E "^TWITCH_|^YOUTUBE_|^SPOTIFY_" .env
```

### Validation Script

```bash
#!/bin/bash
# validate-env.sh - Check for required variables

required=(
  POSTGRES_PASSWORD
  DISCORD_DB_PASSWORD
  STREAMBOT_DB_PASSWORD
  JARVIS_DB_PASSWORD
  WEB_USERNAME
  WEB_PASSWORD
  SESSION_SECRET
)

for var in "${required[@]}"; do
  if ! grep -q "^${var}=" .env || [ -z "$(grep "^${var}=" .env | cut -d'=' -f2)" ]; then
    echo "❌ Missing: $var"
  else
    echo "✓ Set: $var"
  fi
done
```

---

## Security Best Practices

1. **Generate unique passwords** for each database user
2. **Never reuse** the same secret across services
3. **Rotate secrets** periodically (especially after team changes)
4. **Use long passwords** (32+ characters for secrets)
5. **Set file permissions**: `chmod 600 .env`
6. **Never commit** `.env` to version control
7. **Backup** your `.env` file securely

---

## Related Documentation

- [Deployment Guide](../deploy/deployment-guide.md)
- [Bootstrap Script](../../bootstrap-homelab.sh)
- [Docker Compose Configuration](../../docker-compose.yml)
- [Local Services Compose](../../compose.local.yml)
