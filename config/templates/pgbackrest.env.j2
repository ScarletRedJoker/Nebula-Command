# ============================================
# PGBACKREST BACKUP SERVICE CONFIGURATION
# Auto-generated from config templates
# Environment: {{ environment }}
# ============================================

# S3 Repository Configuration (MinIO)
PGBACKREST_REPO1_TYPE=s3
PGBACKREST_REPO1_S3_ENDPOINT={{ config.minio_host }}:{{ config.ports.minio }}
PGBACKREST_REPO1_S3_BUCKET={{ config.database.backup_bucket | default('homelab-backups') }}
PGBACKREST_REPO1_S3_REGION={{ config.database.backup_region | default('us-east-1') }}
PGBACKREST_REPO1_S3_KEY={{ secrets.minio_root_user }}
PGBACKREST_REPO1_S3_KEY_SECRET={{ secrets.minio_root_password }}
PGBACKREST_REPO1_S3_VERIFY_TLS=n
PGBACKREST_REPO1_PATH=/pgbackrest

# PostgreSQL Connection
PGBACKREST_STANZA=homelab
PGBACKREST_PG1_HOST={{ config.postgres_host }}
PGBACKREST_PG1_PORT={{ config.ports.postgres }}
PGBACKREST_PG1_USER=postgres
PGBACKREST_PG1_DATABASE=postgres
PGBACKREST_PG1_PATH=/var/lib/postgresql/data

# Backup Retention Policy
PGBACKREST_RETENTION_FULL={{ config.database.backup_retention_full | default(7) }}
PGBACKREST_RETENTION_DIFF={{ config.database.backup_retention_diff | default(4) }}
PGBACKREST_RETENTION_ARCHIVE={{ config.database.backup_retention_archive | default(7) }}

# Performance Settings
PGBACKREST_PROCESS_MAX={{ config.database.backup_process_max | default(4) }}
PGBACKREST_COMPRESS_TYPE={{ config.database.backup_compress_type | default('lz4') }}
PGBACKREST_COMPRESS_LEVEL={{ config.database.backup_compress_level | default(3) }}

# Archive Settings
PGBACKREST_ARCHIVE_ASYNC=y
PGBACKREST_ARCHIVE_PUSH_QUEUE_MAX={{ config.database.archive_queue_max | default('1GB') }}

# Logging
PGBACKREST_LOG_LEVEL_CONSOLE=info
PGBACKREST_LOG_LEVEL_FILE=detail
PGBACKREST_LOG_PATH=/var/log/pgbackrest

# Backup Schedule (managed by cron)
# Full backup: {{ config.database.backup_schedule_full | default('0 2 * * *') }}
# Incremental: {{ config.database.backup_schedule_incr | default('0 */1 * * *') }}
