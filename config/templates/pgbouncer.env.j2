# ============================================
# PGBOUNCER CONNECTION POOLER CONFIGURATION
# Auto-generated from config templates
# Environment: {{ environment }}
# ============================================

# PostgreSQL Backend Connection
DB_HOST={{ config.postgres_host }}
DB_PORT={{ config.ports.postgres }}
DB_USER=postgres
DB_PASSWORD={{ secrets.postgres_password }}

# Pooling Mode
# transaction: Best for web applications (recommended)
# session: One connection per client session
# statement: Most aggressive pooling (use with caution)
POOL_MODE={{ config.database.pool_mode | default('transaction') }}

# Connection Limits
MAX_CLIENT_CONN={{ config.database.max_client_conn | default(1000) }}
DEFAULT_POOL_SIZE={{ config.database.default_pool_size | default(25) }}
MIN_POOL_SIZE={{ config.database.min_pool_size | default(10) }}
RESERVE_POOL_SIZE={{ config.database.reserve_pool_size | default(5) }}
MAX_DB_CONNECTIONS={{ config.database.max_db_connections | default(100) }}

# Server Lifetime
SERVER_LIFETIME={{ config.database.server_lifetime | default(3600) }}
SERVER_IDLE_TIMEOUT={{ config.database.server_idle_timeout | default(600) }}

# Query Timeout
QUERY_TIMEOUT={{ config.database.query_timeout | default(0) }}
QUERY_WAIT_TIMEOUT={{ config.database.query_wait_timeout | default(120) }}

# Logging
LOG_CONNECTIONS={{ config.database.log_connections | default(1) }}
LOG_DISCONNECTIONS={{ config.database.log_disconnections | default(1) }}
LOG_POOLER_ERRORS={{ config.database.log_pooler_errors | default(1) }}

# Database Definitions
DATABASES=postgres = host={{ config.postgres_host }} port={{ config.ports.postgres }} dbname=postgres
ticketbot = host={{ config.postgres_host }} port={{ config.ports.postgres }} dbname=ticketbot
streambot = host={{ config.postgres_host }} port={{ config.ports.postgres }} dbname=streambot
homelab_jarvis = host={{ config.postgres_host }} port={{ config.ports.postgres }} dbname=homelab_jarvis

# User Authentication
USERLIST="postgres" "{{ secrets.postgres_password }}"
"ticketbot" "{{ secrets.discord_db_password }}"
"streambot" "{{ secrets.streambot_db_password }}"
"jarvis" "{{ secrets.jarvis_db_password }}"

# Admin Users
ADMIN_USERS=postgres
STATS_USERS=postgres
