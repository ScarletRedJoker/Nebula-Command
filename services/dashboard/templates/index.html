{% extends "base.html" %}

{% block title %}Mission Control - NebulaCommand Dashboard{% endblock %}
{% block page_title %}NebulaCommand Mission Control{% endblock %}

{% block content %}
<div class="control-panel-card cosmic-glass-card cosmic-slide-in mb-4">
    <div style="text-align: center; padding: 20px 0;">
        <h1 style="font-size: 2.2rem; margin-bottom: 12px; font-weight: 700; background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            <i class="bi bi-hdd-rack"></i> MISSION CONTROL CENTER
        </h1>
        <p style="font-size: 1rem; color: var(--text-secondary); margin: 0;">
            <span class="data-readout">SYSTEM STATUS: OPERATIONAL</span>
        </p>
    </div>
</div>

<div class="led-panel mb-4">
    <div class="led-group">
        <div class="led-label">POWER</div>
        <span class="status-led online blink"></span>
    </div>
    <div class="led-group">
        <div class="led-label">CPU</div>
        <span class="status-led online"></span>
    </div>
    <div class="led-group">
        <div class="led-label">MEMORY</div>
        <span class="status-led warning"></span>
    </div>
    <div class="led-group">
        <div class="led-label">DISK</div>
        <span class="status-led online"></span>
    </div>
    <div class="led-group">
        <div class="led-label">NETWORK</div>
        <span class="status-led active blink"></span>
    </div>
    <div class="led-group">
        <div class="led-label">DOCKER</div>
        <span class="hex-led"></span>
    </div>
    <div class="led-group">
        <div class="led-label">DATABASE</div>
        <span class="hex-led"></span>
    </div>
    <div class="led-group">
        <div class="led-label">PROXY</div>
        <span class="hex-led"></span>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="metric-display glow-border">
            <div class="metric-icon" style="color: var(--accent-blue);">
                <i class="bi bi-box-seam"></i>
            </div>
            <div style="flex: 1;">
                <div class="metric-value" id="container-count">-</div>
                <div class="metric-label">CONTAINERS</div>
            </div>
            <span class="status-led active blink"></span>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="metric-display glow-border">
            <div class="metric-icon" style="color: var(--accent-green);">
                <i class="bi bi-play-circle-fill"></i>
            </div>
            <div style="flex: 1;">
                <div class="metric-value" id="running-count">-</div>
                <div class="metric-label">RUNNING</div>
            </div>
            <span class="status-led online"></span>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="metric-display glow-border">
            <div class="metric-icon" style="color: var(--accent-purple);">
                <i class="bi bi-globe"></i>
            </div>
            <div style="flex: 1;">
                <div class="metric-value">3</div>
                <div class="metric-label">DOMAINS</div>
            </div>
            <span class="status-led online"></span>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="metric-display glow-border">
            <div class="metric-icon" style="color: var(--accent-green);">
                <i class="bi bi-check2-circle"></i>
            </div>
            <div style="flex: 1;">
                <div class="metric-value" id="services-online">6</div>
                <div class="metric-label">SERVICES</div>
            </div>
            <span class="status-led online blink"></span>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="control-panel-card cosmic-glass-card cosmic-slide-in">
            <div class="diagnostic-header">
                <span class="status-led active blink"></span>
                <h5 style="margin: 0; font-weight: 600;">QUICK ACCESS TERMINAL</h5>
            </div>
            <div style="display: grid; gap: 12px;">
                <a href="/dashboard" class="control-btn" style="text-decoration: none; text-align: center;" aria-label="Go to Mission Control Dashboard">
                    <i class="bi bi-speedometer2" aria-hidden="true"></i> MISSION CONTROL DASHBOARD
                </a>
                <a href="/containers" class="control-btn" style="text-decoration: none; text-align: center;" aria-label="Go to Container Management">
                    <i class="bi bi-box-seam" aria-hidden="true"></i> CONTAINER MANAGEMENT
                </a>
                <a href="/system" class="control-btn" style="text-decoration: none; text-align: center;" aria-label="Go to System Diagnostics">
                    <i class="bi bi-cpu" aria-hidden="true"></i> SYSTEM DIAGNOSTICS
                </a>
                <a href="/network" class="control-btn" style="text-decoration: none; text-align: center;" aria-label="Go to Network Monitor">
                    <i class="bi bi-diagram-3" aria-hidden="true"></i> NETWORK MONITOR
                </a>
                <a href="/domains" class="control-btn" style="text-decoration: none; text-align: center;" aria-label="Go to Domain Health Check">
                    <i class="bi bi-globe" aria-hidden="true"></i> DOMAIN HEALTH CHECK
                </a>
                <a href="/logs" class="control-btn" style="text-decoration: none; text-align: center;" aria-label="Go to System Logs">
                    <i class="bi bi-file-text" aria-hidden="true"></i> SYSTEM LOGS
                </a>
            </div>
        </div>
    </div>

    <div class="col-md-6 mb-4">
        <div class="control-panel-card cosmic-glass-card cosmic-slide-in">
            <div class="diagnostic-header">
                <span class="hex-led"></span>
                <h5 style="margin: 0; font-weight: 600;">SERVICE STATUS ARRAY</h5>
            </div>
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <div class="status-indicator-box">
                    <span class="status-led online blink" id="status-discord-led"></span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.95rem;">Discord Ticket Bot</div>
                        <a href="https://bot.rig-city.com" target="_blank" rel="noopener noreferrer" class="data-readout" style="font-size: 0.8rem; text-decoration: none;">bot.rig-city.com <i class="bi bi-box-arrow-up-right"></i></a>
                    </div>
                    <span class="badge badge-success">ONLINE</span>
                </div>
                
                <div class="status-indicator-box">
                    <span class="status-led online blink" id="status-stream-led"></span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.95rem;">Stream Bot AI</div>
                        <a href="https://stream.rig-city.com" target="_blank" rel="noopener noreferrer" class="data-readout" style="font-size: 0.8rem; text-decoration: none;">stream.rig-city.com <i class="bi bi-box-arrow-up-right"></i></a>
                    </div>
                    <span class="badge badge-success">ONLINE</span>
                </div>
                
                <div class="status-indicator-box">
                    <span class="status-led online" id="status-plex-led"></span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.95rem;">Plex Media Server</div>
                        <a href="https://plex.evindrake.net" target="_blank" rel="noopener noreferrer" class="data-readout" style="font-size: 0.8rem; text-decoration: none;">plex.evindrake.net <i class="bi bi-box-arrow-up-right"></i></a>
                    </div>
                    <span class="badge badge-success">ONLINE</span>
                </div>
                
                <div class="status-indicator-box">
                    <span class="status-led online" id="status-n8n-led"></span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.95rem;">n8n Automation Platform</div>
                        <a href="https://n8n.evindrake.net" target="_blank" rel="noopener noreferrer" class="data-readout" style="font-size: 0.8rem; text-decoration: none;">n8n.evindrake.net <i class="bi bi-box-arrow-up-right"></i></a>
                    </div>
                    <span class="badge badge-success">ONLINE</span>
                </div>
                
                <div class="status-indicator-box">
                    <span class="status-led online" id="status-static-led"></span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.95rem;">Static Website</div>
                        <a href="https://scarletredjoker.com" target="_blank" rel="noopener noreferrer" class="data-readout" style="font-size: 0.8rem; text-decoration: none;">scarletredjoker.com <i class="bi bi-box-arrow-up-right"></i></a>
                    </div>
                    <span class="badge badge-success">ONLINE</span>
                </div>
                
                <div class="status-indicator-box">
                    <span class="status-led warning" id="status-vnc-led"></span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 0.95rem;">VNC Desktop</div>
                        <a href="https://vnc.evindrake.net" target="_blank" rel="noopener noreferrer" class="data-readout" style="font-size: 0.8rem; text-decoration: none;">vnc.evindrake.net <i class="bi bi-box-arrow-up-right"></i></a>
                    </div>
                    <span class="badge badge-warning">CHECK</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="diagnostic-panel cosmic-glass-card cosmic-fade-in">
            <div class="diagnostic-header">
                <span class="hex-led"></span>
                <h5 style="margin: 0; font-weight: 600;">SYSTEM DIAGNOSTICS</h5>
                <div style="margin-left: auto;">
                    <div class="activity-indicator">
                        <span class="activity-dot"></span>
                        <span>LIVE</span>
                    </div>
                </div>
            </div>
            <div class="system-status">
                <div class="status-indicator-box">
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px;">HOSTNAME</div>
                        <div class="data-readout" id="hostname">Loading...</div>
                    </div>
                </div>
                <div class="status-indicator-box">
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px;">UPTIME</div>
                        <div class="data-readout" id="uptime">Loading...</div>
                    </div>
                </div>
                <div class="status-indicator-box">
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px;">PLATFORM</div>
                        <div class="data-readout" id="platform">Loading...</div>
                    </div>
                </div>
                <div class="status-indicator-box">
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px;">ARCHITECTURE</div>
                        <div class="data-readout" id="arch">Loading...</div>
                    </div>
                </div>
                <div class="status-indicator-box">
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px;">DOCKER</div>
                        <div class="data-readout" id="docker-version">Loading...</div>
                    </div>
                </div>
                <div class="status-indicator-box">
                    <div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 4px;">LAST UPDATE</div>
                        <div class="data-readout" id="last-update">Just now</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function loadSystemData() {
    try {
        const [containersRes, statsRes] = await Promise.all([
            fetch('/api/containers', { credentials: 'include' }),
            fetch('/api/system/stats', { credentials: 'include' })
        ]);
        
        const containers = await containersRes.json();
        const stats = await statsRes.json();
        
        if (containers.success && Array.isArray(containers.data)) {
            const total = containers.data.length;
            const running = containers.data.filter(c => c.status && c.status.includes('Up')).length;
            
            const containerCountEl = document.getElementById('container-count');
            const runningCountEl = document.getElementById('running-count');
            
            if (containerCountEl) containerCountEl.textContent = total;
            if (runningCountEl) runningCountEl.textContent = running;
        }
        
        if (stats.success && stats.data) {
            const data = stats.data;
            
            const hostnameEl = document.getElementById('hostname');
            const platformEl = document.getElementById('platform');
            const archEl = document.getElementById('arch');
            const uptimeEl = document.getElementById('uptime');
            
            if (data.hostname && hostnameEl) hostnameEl.textContent = data.hostname.toUpperCase();
            if (data.platform && platformEl) platformEl.textContent = data.platform.toUpperCase();
            if (data.architecture && archEl) archEl.textContent = data.architecture.toUpperCase();
            
            if (data.uptime && uptimeEl) {
                const days = Math.floor(data.uptime / 86400);
                const hours = Math.floor((data.uptime % 86400) / 3600);
                const mins = Math.floor((data.uptime % 3600) / 60);
                uptimeEl.textContent = `${days}D ${hours}H ${mins}M`;
            }
        }
        
        const lastUpdateEl = document.getElementById('last-update');
        if (lastUpdateEl) lastUpdateEl.textContent = new Date().toLocaleTimeString();
        
    } catch (error) {
        console.error('Failed to load system data:', error);
        showToast('Failed to load system data', 'error');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    loadSystemData();
    setInterval(loadSystemData, 5000);
});
</script>
{% endblock %}
