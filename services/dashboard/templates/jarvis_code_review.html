{% extends "base.html" %}

{% block title %}Jarvis Code Review{% endblock %}

{% block extra_css %}
<style>
    .code-review-container {
        display: grid;
        grid-template-columns: 350px 1fr;
        gap: 24px;
        height: calc(100vh - 180px);
    }
    
    .task-list-panel {
        background: linear-gradient(145deg, rgba(31, 41, 55, 0.8), rgba(17, 24, 39, 0.9));
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 12px;
        padding: 20px;
        overflow-y: auto;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    
    .task-filters {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }
    
    .filter-btn {
        padding: 6px 12px;
        border-radius: 8px;
        border: 1px solid rgba(139, 92, 246, 0.3);
        background: rgba(139, 92, 246, 0.1);
        color: var(--text-primary);
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.2s;
    }
    
    .filter-btn:hover {
        background: rgba(139, 92, 246, 0.2);
        border-color: rgba(139, 92, 246, 0.5);
    }
    
    .filter-btn.active {
        background: linear-gradient(135deg, #8B5CF6, #3B82F6);
        border-color: #8B5CF6;
        color: white;
    }
    
    .task-item {
        background: rgba(31, 41, 55, 0.6);
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .task-item:hover {
        border-color: rgba(139, 92, 246, 0.5);
        background: rgba(31, 41, 55, 0.8);
        transform: translateX(4px);
    }
    
    .task-item.active {
        border-color: #8B5CF6;
        background: rgba(139, 92, 246, 0.2);
    }
    
    .task-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 4px;
        font-size: 0.9rem;
    }
    
    .task-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 8px;
    }
    
    .task-type-badge {
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .task-type-clarification {
        background: rgba(251, 191, 36, 0.2);
        color: #fbbf24;
    }
    
    .task-type-review {
        background: rgba(139, 92, 246, 0.2);
        color: #a78bfa;
    }
    
    .task-type-approval {
        background: rgba(52, 211, 153, 0.2);
        color: #34d399;
    }
    
    .task-type-action {
        background: rgba(248, 113, 113, 0.2);
        color: #f87171;
    }
    
    .priority-badge {
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 600;
    }
    
    .priority-critical { background: #dc2626; color: white; }
    .priority-high { background: #f97316; color: white; }
    .priority-medium { background: #eab308; color: black; }
    .priority-low { background: #22c55e; color: white; }
    
    .task-detail-panel {
        background: linear-gradient(145deg, rgba(31, 41, 55, 0.8), rgba(17, 24, 39, 0.9));
        border: 1px solid rgba(139, 92, 246, 0.2);
        border-radius: 12px;
        padding: 24px;
        overflow-y: auto;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    
    .task-detail-header {
        border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        padding-bottom: 16px;
        margin-bottom: 20px;
    }
    
    .task-detail-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 8px;
    }
    
    .task-detail-meta {
        display: flex;
        gap: 12px;
        align-items: center;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    
    .task-description {
        background: rgba(0, 0, 0, 0.3);
        border-left: 3px solid #8B5CF6;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        color: var(--text-primary);
        white-space: pre-wrap;
    }
    
    .diff-viewer {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-bottom: 20px;
    }
    
    .diff-side {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 8px;
        overflow: hidden;
    }
    
    .diff-header {
        background: rgba(139, 92, 246, 0.2);
        padding: 8px 12px;
        font-weight: 600;
        font-size: 0.85rem;
        border-bottom: 1px solid rgba(139, 92, 246, 0.3);
    }
    
    .diff-content {
        padding: 16px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.85rem;
        line-height: 1.6;
        overflow-x: auto;
        max-height: 400px;
        overflow-y: auto;
    }
    
    .code-line-added {
        background: rgba(52, 211, 153, 0.1);
        border-left: 3px solid #34d399;
        padding-left: 8px;
    }
    
    .code-line-removed {
        background: rgba(248, 113, 113, 0.1);
        border-left: 3px solid #f87171;
        padding-left: 8px;
    }
    
    .task-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid rgba(139, 92, 246, 0.2);
    }
    
    .btn-action {
        flex: 1;
        padding: 12px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        font-size: 0.95rem;
    }
    
    .btn-approve {
        background: linear-gradient(135deg, #10b981, #34d399);
        color: white;
    }
    
    .btn-approve:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }
    
    .btn-reject {
        background: linear-gradient(135deg, #ef4444, #f87171);
        color: white;
    }
    
    .btn-reject:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
    }
    
    .btn-changes {
        background: linear-gradient(135deg, #f59e0b, #fbbf24);
        color: white;
    }
    
    .btn-changes:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
    }
    
    .comments-section {
        margin-top: 20px;
    }
    
    .comments-textarea {
        width: 100%;
        min-height: 100px;
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(139, 92, 246, 0.3);
        border-radius: 8px;
        padding: 12px;
        color: var(--text-primary);
        font-family: inherit;
        resize: vertical;
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
    }
    
    .empty-state i {
        font-size: 4rem;
        margin-bottom: 16px;
        opacity: 0.5;
    }
    
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(139, 92, 246, 0.3);
        border-radius: 50%;
        border-top-color: #8B5CF6;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
</style>
{% endblock %}

{% block content %}
<div class="header">
    <h2><i class="bi bi-code-square"></i> Jarvis Code Review</h2>
    <button class="theme-toggle" onclick="refreshTasks()">
        <i class="bi bi-arrow-clockwise"></i>
        Refresh
    </button>
</div>

<div class="code-review-container">
    <!-- Task List Panel -->
    <div class="task-list-panel">
        <h5 style="margin-bottom: 16px; color: var(--text-primary);">
            <i class="bi bi-list-task"></i> Pending Tasks
            <span class="badge bg-primary" id="task-count">0</span>
        </h5>
        
        <!-- Filters -->
        <div class="task-filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="review">Review</button>
            <button class="filter-btn" data-filter="clarification">Clarification</button>
            <button class="filter-btn" data-filter="action">Action</button>
        </div>
        
        <!-- Task List -->
        <div id="task-list">
            <div class="empty-state">
                <i class="bi bi-inbox"></i>
                <p>No pending tasks</p>
            </div>
        </div>
    </div>
    
    <!-- Task Detail Panel -->
    <div class="task-detail-panel">
        <div id="task-detail">
            <div class="empty-state">
                <i class="bi bi-arrow-left"></i>
                <h4>Select a task to review</h4>
                <p>Click on a task from the list to see details and take action</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/jarvis_code_review.js') }}?v={{ range(1, 1000) | random }}"></script>
{% endblock %}
