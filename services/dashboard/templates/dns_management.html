{% extends "base.html" %}

{% block title %}DNS Records Management - NebulaCommand Dashboard{% endblock %}

{% block content %}
<div class="container-fluid dns-management-page">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2><i class="bi bi-hdd-network"></i> DNS Records Management</h2>
                    <p class="text-muted mb-0">Manage DNS records across your domains via ZoneEdit</p>
                </div>
                <div class="d-flex gap-2">
                    <select class="form-select zone-selector" id="zone-selector" aria-label="Select domain zone">
                        <option value="">Select Domain...</option>
                    </select>
                    <button class="btn btn-primary btn-lg" onclick="showAddRecordModal()" aria-label="Add new DNS record" id="add-record-btn" disabled>
                        <i class="bi bi-plus-circle" aria-hidden="true"></i> Add Record
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stat-card glassmorphic-panel">
                <div class="stat-icon bg-primary">
                    <i class="bi bi-list-ul"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-records">0</h3>
                    <p>Total Records</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card glassmorphic-panel">
                <div class="stat-icon bg-success">
                    <i class="bi bi-link-45deg"></i>
                </div>
                <div class="stat-content">
                    <h3 id="a-records">0</h3>
                    <p>A Records</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card glassmorphic-panel">
                <div class="stat-icon bg-info">
                    <i class="bi bi-arrow-repeat"></i>
                </div>
                <div class="stat-content">
                    <h3 id="cname-records">0</h3>
                    <p>CNAME Records</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card glassmorphic-panel">
                <div class="stat-icon bg-warning">
                    <i class="bi bi-three-dots"></i>
                </div>
                <div class="stat-content">
                    <h3 id="other-records">0</h3>
                    <p>Other Records</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="glassmorphic-panel records-panel">
                <div class="panel-header">
                    <h5><i class="bi bi-table"></i> DNS Records</h5>
                    <div class="panel-actions">
                        <select class="form-select filter-select" id="type-filter" aria-label="Filter by record type">
                            <option value="">All Types</option>
                            <option value="A">A</option>
                            <option value="AAAA">AAAA</option>
                            <option value="CNAME">CNAME</option>
                            <option value="MX">MX</option>
                            <option value="TXT">TXT</option>
                            <option value="NS">NS</option>
                            <option value="DYN">DYN</option>
                        </select>
                        <button class="btn btn-sm btn-outline-primary" onclick="refreshRecords()" aria-label="Refresh DNS records" id="refresh-btn" disabled>
                            <i class="bi bi-arrow-clockwise" aria-hidden="true"></i> Refresh
                        </button>
                        <button class="btn btn-sm btn-outline-primary" onclick="exportRecordsJSON()" aria-label="Export DNS records as JSON" id="export-json-btn" disabled>
                            <i class="bi bi-download" aria-hidden="true"></i> Export JSON
                        </button>
                        <button class="btn btn-sm btn-outline-success" onclick="exportRecordsCSV()" aria-label="Export DNS records as CSV" id="export-csv-btn" disabled>
                            <i class="bi bi-download" aria-hidden="true"></i> Export CSV
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="showImportModal()" aria-label="Import DNS records" id="import-btn" disabled>
                            <i class="bi bi-upload" aria-hidden="true"></i> Import
                        </button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table records-table">
                        <thead>
                            <tr>
                                <th scope="col">Type</th>
                                <th scope="col">Host</th>
                                <th scope="col">Content</th>
                                <th scope="col">TTL</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="records-tbody">
                            <tr>
                                <td colspan="5" class="text-center py-5 text-muted">
                                    <i class="bi bi-inbox fs-1"></i><br>
                                    Select a domain to view DNS records
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addRecordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content glassmorphic-panel">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-plus-circle"></i> <span id="modal-title-text">Add DNS Record</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="recordForm">
                    <input type="hidden" id="record-id">
                    
                    <div class="mb-3">
                        <label for="record-type" class="form-label">Record Type <span class="text-danger">*</span></label>
                        <select class="form-select" id="record-type" required>
                            <option value="">Select Type...</option>
                            <option value="A">A - IPv4 Address</option>
                            <option value="AAAA">AAAA - IPv6 Address</option>
                            <option value="CNAME">CNAME - Canonical Name</option>
                            <option value="MX">MX - Mail Exchange</option>
                            <option value="TXT">TXT - Text Record</option>
                            <option value="NS">NS - Name Server</option>
                            <option value="DYN">DYN - Dynamic DNS</option>
                        </select>
                        <div class="form-text">Select the DNS record type</div>
                    </div>

                    <div class="mb-3">
                        <label for="record-host" class="form-label">Host <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="record-host" placeholder="@ or subdomain" required>
                        <div class="form-text">Use "@" for root domain, or enter subdomain (e.g., "www", "mail")</div>
                    </div>

                    <div class="mb-3">
                        <label for="record-value" class="form-label">Content/Value <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="record-value" placeholder="e.g., 74.76.32.151" required>
                        <div class="form-text" id="value-help-text">Enter the target value for this record</div>
                    </div>

                    <div class="mb-3">
                        <label for="record-ttl" class="form-label">TTL (Time to Live)</label>
                        <select class="form-select" id="record-ttl">
                            <option value="60">1 minute</option>
                            <option value="300" selected>5 minutes</option>
                            <option value="600">10 minutes</option>
                            <option value="1800">30 minutes</option>
                            <option value="3600">1 hour</option>
                            <option value="7200">2 hours</option>
                            <option value="14400">4 hours</option>
                            <option value="86400">24 hours</option>
                        </select>
                        <div class="form-text">How long DNS servers should cache this record</div>
                    </div>

                    <div class="alert alert-info" id="record-type-hint" style="display: none;">
                        <small id="hint-text"></small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Cancel">Cancel</button>
                <button type="button" class="btn btn-primary" id="submitRecordBtn" onclick="submitRecord()" aria-label="Submit DNS record">
                    <span class="btn-text">Add Record</span>
                    <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteRecordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content glassmorphic-panel">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="bi bi-exclamation-triangle"></i> Delete DNS Record
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <strong>Warning:</strong> This will immediately delete the DNS record from ZoneEdit!
                </div>
                <p>You are about to delete:</p>
                <div class="record-delete-preview glassmorphic-panel p-3 mb-3">
                    <dl class="row mb-0">
                        <dt class="col-sm-3">Type:</dt>
                        <dd class="col-sm-9" id="delete-record-type"></dd>
                        <dt class="col-sm-3">Host:</dt>
                        <dd class="col-sm-9" id="delete-record-host"></dd>
                        <dt class="col-sm-3">Value:</dt>
                        <dd class="col-sm-9" id="delete-record-value"></dd>
                    </dl>
                </div>
                <p class="mt-3">Type <strong>DELETE</strong> to confirm:</p>
                <input type="text" class="form-control" id="delete-confirmation" placeholder="DELETE">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Cancel deletion">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="deleteRecord()" disabled aria-label="Confirm deletion">
                    Delete Record
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="importModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content glassmorphic-panel">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-upload"></i> Import DNS Records
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Supported Formats:</strong> JSON and CSV files
                </div>
                
                <div class="mb-3">
                    <label for="import-file" class="form-label">Select File <span class="text-danger">*</span></label>
                    <input type="file" class="form-control" id="import-file" accept=".json,.csv" required>
                    <div class="form-text">
                        Upload a JSON or CSV file containing DNS records to import
                    </div>
                </div>

                <div class="import-format-info">
                    <h6 class="mb-2">File Format Examples:</h6>
                    <div class="format-example">
                        <strong>JSON Format:</strong>
                        <pre><code>{
  "records": [
    {"type": "A", "host": "www", "value": "192.168.1.1", "ttl": 300},
    {"type": "CNAME", "host": "blog", "value": "example.com", "ttl": 3600}
  ]
}</code></pre>
                    </div>
                    <div class="format-example mt-2">
                        <strong>CSV Format:</strong>
                        <pre><code>type,host,value,ttl
A,www,192.168.1.1,300
CNAME,blog,example.com,3600</code></pre>
                    </div>
                </div>

                <div class="alert alert-warning mt-3">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>Note:</strong> Duplicate records will be skipped automatically
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Cancel import">Cancel</button>
                <button type="button" class="btn btn-primary" id="submitImportBtn" onclick="submitImport()" disabled aria-label="Submit import">
                    <span class="btn-text">Import Records</span>
                    <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                </button>
            </div>
        </div>
    </div>
</div>

<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="toast" class="toast" role="alert">
        <div class="toast-header">
            <i class="bi me-2" id="toast-icon"></i>
            <strong class="me-auto" id="toast-title">Notification</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toast-body"></div>
    </div>
</div>

<style>
.dns-management-page {
    padding: 20px;
}

.glassmorphic-panel {
    background: linear-gradient(145deg, rgba(26, 35, 50, 0.9), rgba(17, 24, 39, 0.9));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(96, 165, 250, 0.2);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.stat-card {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px !important;
}

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: white;
}

.stat-content h3 {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
}

.stat-content p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.zone-selector {
    min-width: 250px;
    max-width: 350px;
    background: rgba(26, 35, 50, 0.8);
    border: 1px solid rgba(96, 165, 250, 0.3);
    color: var(--text-primary);
}

.zone-selector:focus {
    border-color: rgba(96, 165, 250, 0.6);
    box-shadow: 0 0 0 0.25rem rgba(96, 165, 250, 0.15);
}

.panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
}

.panel-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

.filter-select {
    max-width: 200px;
    background: rgba(26, 35, 50, 0.8);
    border: 1px solid rgba(96, 165, 250, 0.3);
    color: var(--text-primary);
}

.filter-select:focus {
    border-color: rgba(96, 165, 250, 0.6);
    box-shadow: 0 0 0 0.25rem rgba(96, 165, 250, 0.15);
}

.records-table {
    color: var(--text-primary);
}

.records-table thead th {
    background: rgba(96, 165, 250, 0.1);
    border-bottom: 2px solid rgba(96, 165, 250, 0.3);
    padding: 12px;
}

.records-table tbody tr {
    border-bottom: 1px solid rgba(96, 165, 250, 0.1);
    transition: background 0.2s;
}

.records-table tbody tr:hover {
    background: rgba(96, 165, 250, 0.05);
}

.records-table tbody td {
    padding: 12px;
    vertical-align: middle;
}

.record-type-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    min-width: 60px;
    text-align: center;
}

.type-a { background: rgba(52, 211, 153, 0.2); color: #34d399; }
.type-aaaa { background: rgba(52, 211, 153, 0.2); color: #34d399; }
.type-cname { background: rgba(96, 165, 250, 0.2); color: #60a5fa; }
.type-mx { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
.type-txt { background: rgba(168, 139, 250, 0.2); color: #a78bfa; }
.type-ns { background: rgba(244, 114, 182, 0.2); color: #f472b6; }
.type-dyn { background: rgba(248, 113, 113, 0.2); color: #f87171; }

.ttl-badge {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.modal-content.glassmorphic-panel {
    border: 1px solid rgba(96, 165, 250, 0.3);
}

.modal-content .form-control,
.modal-content .form-select {
    background: rgba(26, 35, 50, 0.8);
    border: 1px solid rgba(96, 165, 250, 0.3);
    color: var(--text-primary);
}

.modal-content .form-control:focus,
.modal-content .form-select:focus {
    background: rgba(26, 35, 50, 0.9);
    border-color: rgba(96, 165, 250, 0.6);
    box-shadow: 0 0 0 0.25rem rgba(96, 165, 250, 0.15);
    color: var(--text-primary);
}

.record-delete-preview {
    background: rgba(248, 113, 113, 0.1);
    border: 1px solid rgba(248, 113, 113, 0.3);
}

.btn-action {
    padding: 4px 8px;
    font-size: 0.9rem;
    border-radius: 6px;
    transition: all 0.2s;
}

.import-format-info {
    background: rgba(96, 165, 250, 0.05);
    border: 1px solid rgba(96, 165, 250, 0.2);
    border-radius: 8px;
    padding: 15px;
}

.format-example pre {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(96, 165, 250, 0.2);
    border-radius: 6px;
    padding: 10px;
    margin: 5px 0 0 0;
    overflow-x: auto;
}

.format-example code {
    color: #60a5fa;
    font-size: 0.85rem;
}

@media (max-width: 768px) {
    .zone-selector {
        min-width: 100%;
        max-width: 100%;
    }
    
    .panel-actions {
        flex-wrap: wrap;
        width: 100%;
    }
    
    .filter-select {
        max-width: none;
        flex: 1;
    }
}
</style>

<script src="{{ url_for('static', filename='js/dns_management.js') }}"></script>
{% endblock %}
