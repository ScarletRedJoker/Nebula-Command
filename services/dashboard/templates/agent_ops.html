{% extends "base.html" %}

{% block title %}Agent Ops Feed - NebulaCommand Dashboard{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/agent_ops.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid agent-ops-page">
    <!-- Header Section -->
    <div class="agent-ops-header mb-4">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h2><i class="bi bi-chat-dots"></i> Agent Operations Feed</h2>
                <p class="text-muted mb-0">Live communication between Jarvis AI and Replit Agent</p>
            </div>
            <div class="col-lg-4 text-end">
                <button class="btn btn-outline-primary me-2" onclick="refreshFeed()" aria-label="Refresh feed">
                    <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
                <button class="btn btn-primary" onclick="simulateAgentDialogue()" aria-label="Simulate agent collaboration">
                    <i class="bi bi-robot"></i> Simulate Collaboration
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stat-card cosmic-glass-card">
                <div class="stat-icon bg-primary">
                    <i class="bi bi-chat-left-text"></i>
                </div>
                <div class="stat-content">
                    <h3 id="total-messages">0</h3>
                    <p>Total Messages</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card cosmic-glass-card">
                <div class="stat-icon bg-success">
                    <i class="bi bi-robot"></i>
                </div>
                <div class="stat-content">
                    <h3 id="jarvis-messages">0</h3>
                    <p>From Jarvis</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card cosmic-glass-card">
                <div class="stat-icon bg-info">
                    <i class="bi bi-code-square"></i>
                </div>
                <div class="stat-content">
                    <h3 id="replit-messages">0</h3>
                    <p>From Replit Agent</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card cosmic-glass-card">
                <div class="stat-icon bg-warning">
                    <i class="bi bi-clock-history"></i>
                </div>
                <div class="stat-content">
                    <h3 id="recent-messages">0</h3>
                    <p>Last 24 Hours</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Feed -->
    <div class="row">
        <div class="col-lg-8">
            <div class="agent-feed-container cosmic-glass-card">
                <div class="feed-header">
                    <h5><i class="bi bi-broadcast"></i> Live Agent Feed</h5>
                    <div class="filter-controls">
                        <select class="form-select form-select-sm" id="message-type-filter" onchange="filterMessages()">
                            <option value="">All Types</option>
                            <option value="task_delegation">Task Delegations</option>
                            <option value="status_update">Status Updates</option>
                            <option value="request">Requests</option>
                            <option value="response">Responses</option>
                        </select>
                    </div>
                </div>
                
                <div class="agent-feed" id="agent-feed">
                    <div class="loading-state">
                        <div class="cosmic-loader"></div>
                        <p class="mt-3 text-muted">Loading agent communications...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Agent Info Sidebar -->
        <div class="col-lg-4">
            <div class="agent-info-panel cosmic-glass-card mb-4">
                <h5><i class="bi bi-info-circle"></i> Agent Overview</h5>
                
                <div class="agent-card mt-3">
                    <div class="agent-avatar jarvis-avatar"></div>
                    <div class="agent-details">
                        <h6>Jarvis AI</h6>
                        <p class="small text-muted">Autonomous Homelab Manager</p>
                        <span class="badge bg-success">
                            <i class="bi bi-circle-fill blink"></i> Active
                        </span>
                    </div>
                </div>

                <div class="agent-card mt-3">
                    <div class="agent-avatar replit-avatar"></div>
                    <div class="agent-details">
                        <h6>Replit Agent</h6>
                        <p class="small text-muted">Code Generation Specialist</p>
                        <span class="badge bg-success">
                            <i class="bi bi-circle-fill blink"></i> Active
                        </span>
                    </div>
                </div>
            </div>

            <!-- Demo Controls -->
            <div class="demo-panel cosmic-glass-card">
                <h5><i class="bi bi-play-circle"></i> Demo Controls</h5>
                <p class="small text-muted">Simulate agent collaboration for investor demos</p>
                
                <div class="d-grid gap-2 mt-3">
                    <button class="btn btn-outline-primary" onclick="simulateAgentDialogue()">
                        <i class="bi bi-broadcast"></i> Full Collaboration Demo
                    </button>
                    <button class="btn btn-outline-success" onclick="simulateTaskDelegation()">
                        <i class="bi bi-arrow-right-circle"></i> Task Delegation
                    </button>
                    <button class="btn btn-outline-info" onclick="simulateDeployment()">
                        <i class="bi bi-rocket-takeoff"></i> Deployment Workflow
                    </button>
                    <button class="btn btn-outline-warning" onclick="clearFeed()">
                        <i class="bi bi-trash"></i> Clear Feed
                    </button>
                </div>
                
                <div class="alert alert-info mt-3 mb-0">
                    <small>
                        <i class="bi bi-info-circle"></i>
                        Simulated messages demonstrate how Jarvis and Replit Agent collaborate on complex tasks.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Message Detail Modal -->
<div class="modal fade" id="messageDetailModal" tabindex="-1" aria-labelledby="messageDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content cosmic-glass-card">
            <div class="modal-header">
                <h5 class="modal-title" id="messageDetailModalLabel">
                    <i class="bi bi-envelope-open"></i> Message Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>From:</strong> <span id="detail-from-agent"></span></p>
                        <p><strong>To:</strong> <span id="detail-to-agent"></span></p>
                        <p><strong>Type:</strong> <span id="detail-type" class="badge"></span></p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Status:</strong> <span id="detail-status" class="badge"></span></p>
                        <p><strong>Priority:</strong> <span id="detail-priority" class="badge"></span></p>
                        <p><strong>Time:</strong> <span id="detail-time"></span></p>
                    </div>
                </div>
                
                <hr>
                
                <div id="detail-subject-container">
                    <h6>Subject:</h6>
                    <p id="detail-subject"></p>
                </div>
                
                <h6>Content:</h6>
                <div class="message-content-detail" id="detail-content"></div>
                
                <div id="detail-metadata-container" style="display: none;">
                    <h6 class="mt-3">Metadata:</h6>
                    <pre id="detail-metadata" class="bg-dark p-2 rounded"></pre>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/agent_ops.js') }}"></script>
<script>
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        initializeAgentOps();
    });
</script>
{% endblock %}
